https://wiki.archlinux.org/title/Unified_kernel_image


I. /etc/kernel/cmdline - add kernel entries there.

"Boot with standard options"  "nvme_loid=YES cryptdevice=/dev/nvme0n1p2:part:allow-discards root=/dev/enigma/root rootflags=subvol=@arch rw quiet bgrt_disable"

Modify cryptdevice, root and subvol if changed.

II. Modify /etc/mkinitcpio.d/linux.preset

# mkinitcpio preset file for the 'linux' package

#ALL_config="/etc/mkinitcpio.conf"
ALL_kver="/boot/vmlinuz-linux"
ALL_microcode=(/boot/*-ucode.img)

PRESETS=('default' 'fallback')

#default_config="/etc/mkinitcpio.conf"
#default_image="/boot/initramfs-linux.img"
default_uki="esp/EFI/Linux/arch-linux.efi"
default_options="--splash=/usr/share/systemd/bootctl/splash-arch.bmp"

#fallback_config="/etc/mkinitcpio.conf"
#fallback_image="/boot/initramfs-linux-fallback.img"
fallback_uki="esp/EFI/Linux/arch-linux-fallback.efi"
fallback_options="-S autodetect"


III. Make sure hook for ucode and nvidia is in /etc/pacman.d/hooks.


IV. mkdir /boot/EFI/Linux

V. mkinitcpio -P linux (linux-zen etc)

VI. Delete unused boot initramfs-*.img

VII. Add uki images to EFI.

efibootmgr --create --disk /dev/nvme0n1p1 --label "OS name" --loader 'EFI\Linux\image-name.efi' --unicode
